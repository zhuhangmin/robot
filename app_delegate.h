#pragma once
#include "robot_define.h"

// 游戏业务
class AppDelegate {
public:
    int Init();

    int Term();

protected:
    int InitLanuch() const;

private:
    // 业务线程函数 
    int ThreadMainProc();

    // 业务主流程
    int MainProcess();

    // 机器人流程 登入大厅 进入游戏
    int RobotProcess(const UserID& userid, const RoomID& roomid);

private:
    // 辅助函数

    // 随机选一个没有进入游戏的userid
    int GetRandomUserIDNotInGame(UserID& random_userid) const;

    // 获得房间此时需要的机器人数量
    int GetRoomNeedCountMap(RoomNeedCountMap& room_count_map);

    // 启动时 集体补银
    int DepositGainAll();

    // 启动时 为已在游戏中的机器人 立即建立大厅连接
    int ConnectHallForAllRobot();

    // 启动时 为已在游戏中的机器人 立即建立游戏连接
    int ConnectGameForRobotInGame();

    // 登陆大厅
    int LogonHall(UserID userid);

    // 进入游戏
    int EnterGame(UserID userid, RoomID roomid, TableNO tableno = InvalidTableNO);

private:
    // @zhuhangmin 20190228
    // 注意： 主流程 单线程
    // 无业务锁, 若有高并发需求，可以让机器人预先进游戏等待
    // 允许脏读数据层data, 但不允许把脏读数据写回数据层data, 只读不写
    YQThread	main_timer_thread_;

    bool inited_{false};
};
